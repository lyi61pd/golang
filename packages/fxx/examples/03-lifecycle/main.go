package lifecycle
package main

import (
































































































































































}	fmt.Println("  â€¢ é€‚åˆç®¡ç†æ•°æ®åº“ã€ç¼“å­˜ç­‰éœ€è¦å¯åŠ¨/å…³é—­çš„èµ„æº")	fmt.Println("  â€¢ OnStop é’©å­æŒ‰ç›¸åé¡ºåºæ‰§è¡Œ")	fmt.Println("  â€¢ OnStart é’©å­æŒ‰æ³¨å†Œé¡ºåºæ‰§è¡Œ")	fmt.Println("\nğŸ’¡ å­¦ä¹ è¦ç‚¹ï¼š")		app.Run()	)		}),			})				},					return nil					}()						shutdowner.Shutdown()						time.Sleep(500 * time.Millisecond)					go func() {					// æ‰§è¡Œå®Œæ¯•åå…³é—­åº”ç”¨										service.GetUser("user456")					service.GetUser("user123")					fmt.Println("\n=== æ‰€æœ‰ç»„ä»¶å·²å¯åŠ¨ï¼Œå¼€å§‹æ‰§è¡Œä¸šåŠ¡é€»è¾‘ ===")				OnStart: func(ctx context.Context) error {			lc.Append(fx.Hook{			// æ³¨å†Œä¸€ä¸ªåœ¨æ‰€æœ‰ç»„ä»¶å¯åŠ¨åæ‰§è¡Œçš„é’©å­		fx.Invoke(func(service *UserService, lc fx.Lifecycle, shutdowner fx.Shutdowner) {		),			NewUserService,			NewCache,			NewDatabase,			NewSimpleLogger,		fx.Provide(	app := fx.New(	fmt.Println("=== fx ç”Ÿå‘½å‘¨æœŸç®¡ç†ç¤ºä¾‹ ===\n")func main() {}	s.logger.Log(dbResult)	dbResult := s.db.Query(fmt.Sprintf("SELECT * FROM users WHERE id='%s'", id))	// å†æŸ¥æ•°æ®åº“	s.logger.Log(cacheResult)	cacheResult := s.cache.Get(id)	// å…ˆæŸ¥ç¼“å­˜	s.logger.Log(fmt.Sprintf("\n--- è·å–ç”¨æˆ· %s ---", id))func (s *UserService) GetUser(id string) {}	}		logger: logger,		cache:  cache,		db:     db,	return &UserService{	logger.Log("âœ“ UserService å·²åˆ›å»º")func NewUserService(db *Database, cache *Cache, logger Logger) *UserService {}	logger Logger	cache  *Cache	db     *Databasetype UserService struct {// UserService ä¾èµ–æ•°æ®åº“å’Œç¼“å­˜}	return fmt.Sprintf("âœ“ ç¼“å­˜å€¼: %s_cached_data", key)	c.logger.Log(fmt.Sprintf("ğŸ—„ï¸  ä»ç¼“å­˜è·å–: %s", key))	}		return "âŒ é”™è¯¯ï¼šç¼“å­˜æœåŠ¡æœªå¯åŠ¨"	if !c.started {func (c *Cache) Get(key string) string {}	return cache	})		},			return nil			logger.Log("âœ“ ç¼“å­˜æœåŠ¡å·²åœæ­¢")			cache.started = false			time.Sleep(100 * time.Millisecond)			logger.Log("âš¡ æ­£åœ¨åœæ­¢ç¼“å­˜æœåŠ¡...")		OnStop: func(ctx context.Context) error {		},			return nil			logger.Log("âœ“ ç¼“å­˜æœåŠ¡å¯åŠ¨æˆåŠŸ")			cache.started = true			time.Sleep(300 * time.Millisecond)			logger.Log("âš¡ æ­£åœ¨å¯åŠ¨ç¼“å­˜æœåŠ¡...")		OnStart: func(ctx context.Context) error {	lc.Append(fx.Hook{	cache := &Cache{logger: logger}func NewCache(lc fx.Lifecycle, logger Logger) *Cache {}	logger  Logger	started booltype Cache struct {// Cache æ¨¡æ‹Ÿç¼“å­˜æœåŠ¡}	return "âœ“ æŸ¥è¯¢ç»“æœ: [ç”¨æˆ·æ•°æ®...]"	db.logger.Log(fmt.Sprintf("ğŸ“ æ‰§è¡ŒæŸ¥è¯¢: %s", sql))	}		return "âŒ é”™è¯¯ï¼šæ•°æ®åº“æœªè¿æ¥"	if !db.connected {func (db *Database) Query(sql string) string {}	return db	})		},			return nil			logger.Log("âœ“ æ•°æ®åº“è¿æ¥å·²å…³é—­")			db.connected = false			time.Sleep(200 * time.Millisecond)			logger.Log("ğŸ”Œ æ­£åœ¨æ–­å¼€æ•°æ®åº“è¿æ¥...")		OnStop: func(ctx context.Context) error {		},			return nil			logger.Log("âœ“ æ•°æ®åº“è¿æ¥æˆåŠŸ")			db.connected = true			time.Sleep(500 * time.Millisecond)			logger.Log("ğŸ”Œ æ­£åœ¨è¿æ¥æ•°æ®åº“...")		OnStart: func(ctx context.Context) error {	lc.Append(fx.Hook{	db := &Database{logger: logger}func NewDatabase(lc fx.Lifecycle, logger Logger) *Database {}	logger    Logger	connected booltype Database struct {// Database æ¨¡æ‹Ÿæ•°æ®åº“è¿æ¥}	fmt.Printf("[LOG] %s\n", message)func (l *SimpleLogger) Log(message string) {}	return &SimpleLogger{}func NewSimpleLogger() Logger {type SimpleLogger struct{}}	Log(message string)type Logger interface {// Logger æ¥å£)	"go.uber.org/fx"	"time"	"fmt"	"context"